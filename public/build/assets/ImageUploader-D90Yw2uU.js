import{U as $}from"./Upload-B42hVkTj.js";import{r as g,y as D,z as j,o as n,d as o,f as _,a as e,e as c,F as C,g as B,t as w,b as N,N as z,x as M,n as L,i as k}from"./app-D_NPw2Tp.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={name:"File",components:{Upload:$},props:["data","permission"],setup(a){let s=g(!1),u=g(),l=g(!1),x=g("");function m(){l.value=!0,x.value={customer_id:a.data}}function f(){l.value=!1,v()}function d(r){console.log(a.permission),a.permission&&Toast.fire({title:"Are you sure?",text:"Once deleted, you will not be able to recover this data !",icon:"warning",timer:!1,position:"center",showCancelButton:!0,dangerMode:!0}).then(p=>{p.isConfirmed?b(r):Toast.fire("Your data is safe!")})}function b(r){r._method="DELETE",z.post("/deleteFile/"+r.id,r,{onSuccess(p){Toast.fire({icon:"success",title:"Your File has been Deleted !"}),v()}})}const y=async()=>{let r="/getCustomerFile/"+a.data;console.log(r);try{return await(await fetch(r)).json()}catch(p){console.error(p)}},F=r=>{r&&(l.value=!1,v(),Toast.fire({icon:"success",title:"Successfully Uploaded the File"}))},v=()=>{y().then(r=>{u.value=r})};return D(()=>{v()}),{file_list:u,add:l,deleteFile:d,addFile:m,closeFile:f,checkUpload:F,incident_id:x,loading:s}}},E={key:0,class:"flex w-full justify-end"},R={key:1,"wire:loading":"",class:"w-full flex flex-col items-center justify-center"},G={key:2},O={class:"overflow-x-auto rounded shadow"},W={class:"min-w-full divide-y divide-gray-200 table-auto"},Y={class:"bg-white divide-y divide-gray-100"},J={class:"px-4 py-2 whitespace-nowrap"},q={class:"px-4 py-2 whitespace-nowrap flex items-center gap-2"},H=["href"],K={class:"px-4 py-2 whitespace-nowrap"},Q={class:"px-4 py-2 whitespace-nowrap text-right"},X=["onClick"],Z={key:0},ee={key:3};function te(a,s,u,l,x,m){const f=j("upload");return n(),o(C,null,[u.permission?(n(),o("div",E,[l.add?c("",!0):(n(),o("a",{key:0,href:"#",onClick:s[0]||(s[0]=d=>l.addFile()),class:"-mt-2 mb-2 text-center items-center px-4 py-3 bg-indigo-500 border border-transparent rounded-sm font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-400 active:bg-indigo-600 focus:outline-none focus:border-gray-900 disabled:opacity-25 transition mr-1"},s[2]||(s[2]=[_("Add File"),e("i",{class:"fas fa-plus-circle opacity-75 lg:ml-1 text-sm"},null,-1)]))),l.add?(n(),o("a",{key:1,href:"#",onClick:s[1]||(s[1]=d=>l.closeFile()),class:"-mt-2 mb-2 text-center items-center px-4 py-3 bg-indigo-500 border border-transparent rounded-sm font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-400 active:bg-indigo-600 focus:outline-none focus:border-gray-900 disabled:opacity-25 transition mr-1"},s[3]||(s[3]=[_("Close"),e("i",{class:"fas fa-times-circle opacity-75 lg:ml-1 text-sm"},null,-1)]))):c("",!0)])):c("",!0),l.file_list?c("",!0):(n(),o("div",R,s[4]||(s[4]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"},null,-1),e("h2",{class:"text-center text-gray-600 text-sm font-semibold mt-2"},"Loading...",-1)]))),l.file_list&&!l.add?(n(),o("div",G,[e("div",O,[e("table",W,[s[8]||(s[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"#"),e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"File"),e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"Type"),e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"Created By"),e("th",{class:"px-4 py-2 text-xs font-semibold text-gray-600 uppercase text-right"},"Action")])],-1)),e("tbody",Y,[(n(!0),o(C,null,B(l.file_list,(d,b)=>{var y;return n(),o("tr",{key:d.id,class:"hover:bg-gray-50 transition"},[e("td",J,w(b+1),1),e("td",q,[e("a",{href:d.path,target:"_blank",class:"text-indigo-600 hover:underline"},[s[5]||(s[5]=e("i",{class:"fas fa-paperclip mr-1"},null,-1)),_(" "+w(d.name),1)],8,H)]),e("td",K,w((y=d.user)==null?void 0:y.name),1),e("td",Q,[e("button",{onClick:F=>l.deleteFile(d),class:"text-red-600 hover:text-red-800 transition",title:"Delete"},s[6]||(s[6]=[e("i",{class:"fa fa-trash"},null,-1)]),8,X)])])}),128)),l.file_list.length===0?(n(),o("tr",Z,s[7]||(s[7]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-400"},"No files found.",-1)]))):c("",!0)])])])])):c("",!0),l.add?(n(),o("div",ee,[N(f,{data:l.incident_id,onStatus:l.checkUpload},null,8,["data","onStatus"])])):c("",!0)],64)}const ye=P(A,[["render",te]]),le=["for"],se={class:"relative"},ie=["disabled"],ae={key:0,class:"space-y-1 text-center"},ne={class:"text-sm text-gray-600"},oe={class:"font-medium text-indigo-600 hover:text-indigo-500"},re={key:1,class:"relative w-full h-full"},de=["src","alt"],ue={class:"absolute top-1 right-1 flex space-x-1 z-20"},ce=["disabled","id"],fe={key:1,class:"mt-2 text-sm text-red-500"},ge={class:"relative"},me=["src","alt"],ve={__name:"ImageUploader",props:{modelValue:{type:[File,null],default:null},imageUrl:{type:String,default:null},submitStatus:{type:String,default:null},existingImage:{type:String,default:null},label:{type:String,default:""},uploadText:{type:String,default:"Click to upload"},disabled:{type:Boolean,default:!1},error:{type:String,default:""},id:{type:String,default:()=>`file-upload-${Math.random().toString(36).substring(2,9)}`}},emits:["update:modelValue","update:imageUrl"],setup(a,{emit:s}){const u=a,l=s,x=g(null),m=g(!1),f=g(u.imageUrl||u.existingImage),d=g(!1),b=g(null);M(()=>u.existingImage,i=>{if(i){const t=i.replace(/\/customer\/\d+\//,"/");f.value=t,l("update:imageUrl",t)}}),D(()=>{if(u.existingImage){const i=u.existingImage.replace(/\/customer\/\d+\//,"/");f.value=i,l("update:imageUrl",i)}});function y(i){x.value=i}function F(){u.disabled||x.value.click()}function v(i){m.value=!0}function r(i){m.value=!1}function p(i){if(m.value=!1,u.disabled)return;const t=i.dataTransfer.files;if(t.length>0){const h=t[0];h.type.startsWith("image/")&&I(h)}}function U(i){const t=i.target.files[0];t&&I(t)}function I(i){if(i.size>10*1024*1024){alert("File size exceeds 10MB limit");return}l("update:modelValue",i);const t=new FileReader;t.onload=h=>{f.value=h.target.result,l("update:imageUrl",h.target.result)},t.readAsDataURL(i)}function V(i){i.stopPropagation(),l("update:modelValue",null),f.value=null,l("update:imageUrl",null)}function T(i){b.value=i,d.value=!0}function S(){d.value=!1,b.value=null}return(i,t)=>(n(),o(C,null,[e("div",null,[a.label?(n(),o("label",{key:0,for:a.id,class:"block text-sm font-medium text-gray-700 mb-1"},w(a.label),9,le)):c("",!0),e("div",se,[e("div",{class:L(["flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-md border-gray-300 hover:border-indigo-500 transition-colors duration-200 cursor-pointer bg-gray-50",{"border-indigo-500 bg-indigo-50":m.value}]),onClick:F,onDragover:k(v,["prevent"]),onDragleave:k(r,["prevent"]),onDrop:k(p,["prevent"]),disabled:a.disabled},[f.value?(n(),o("div",re,[e("img",{src:f.value,alt:`${a.label} Preview`,class:"object-contain w-full h-full rounded-md"},null,8,de),e("div",ue,[e("button",{onClick:t[0]||(t[0]=k(h=>T(a.id),["stop"])),type:"button",class:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-blue-600 transition-colors duration-200",title:"Open Full View"},t[4]||(t[4]=[e("i",{class:"fas fa-external-link-alt text-xs"},null,-1)])),a.submitStatus!=="approved"?(n(),o("button",{key:0,onClick:k(V,["stop"]),type:"button",class:"bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition-colors duration-200",title:"Remove image"},t[5]||(t[5]=[e("i",{class:"fas fa-times text-xs"},null,-1)]))):c("",!0)])])):(n(),o("div",ae,[t[2]||(t[2]=e("i",{class:"fas fa-cloud-upload-alt text-3xl text-gray-400"},null,-1)),e("div",ne,[e("span",oe,w(a.uploadText),1),t[1]||(t[1]=e("span",null," or drag and drop",-1))]),t[3]||(t[3]=e("p",{class:"text-xs text-gray-500"}," PNG, JPG, GIF up to 10MB ",-1))]))],42,ie),a.submitStatus!=="approved"?(n(),o("input",{key:0,ref:y,type:"file",onChange:U,accept:"image/*",class:"hidden",disabled:a.disabled,id:a.id},null,40,ce)):c("",!0)]),a.error?(n(),o("p",fe,w(a.error),1)):c("",!0)]),d.value?(n(),o("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:S},[e("div",ge,[e("img",{class:"max-h-[90vh] max-w-[90vw]",src:f.value,alt:a.label||"Image preview"},null,8,me),e("button",{class:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-8 h-8 flex items-center justify-center",onClick:S},t[6]||(t[6]=[e("span",{class:"text-xl"},"Ã—",-1)]))])])):c("",!0)],64))}};export{ye as C,ve as _};
