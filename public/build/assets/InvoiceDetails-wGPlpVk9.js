import{G as L,z as f,c as M,w as h,m as P,N as S,o as a,a as e,d as l,f as r,t as i,F as k,g as E,e as N,j as D,v as T,k as $,b as v}from"./app-DpF-174O.js";import{A as B}from"./AppLayout-C9WIWcWb.js";import{P as j}from"./Pagination-BG22ogT4.js";import A from"./EditInvoiceItem-C-LPwx3t.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-Cf52uzEg.js";const U=L({components:{AppLayout:B,Pagination:j,Link:P,EditInvoiceItem:A},props:{invoiceItems:Object,invoices:Object},data(){return{showEditModal:!1,selectedItem:null,filters:{type:"",search:""}}},computed:{filteredItems(){return this.invoiceItems.data.filter(t=>{const s=!this.filters.type||t.type===this.filters.type,n=!this.filters.search||t.customer.name.toLowerCase().includes(this.filters.search.toLowerCase());return s&&n})}},methods:{formatDate(t){return t?new Date(t).toLocaleDateString():""},openEditModal(t){console.log(t),this.selectedItem=t,this.showEditModal=!0},closeEditModal(){this.showEditModal=!1,this.selectedItem=null},deleteItem(t){confirm("Are you sure you want to delete this item?")&&S.delete(route("invoiceItems.destroy",t.id),{onSuccess:s=>{Toast.fire({icon:"success",title:s.props.flash.message}),closeModal()},onError:s=>{console.error("Error submitting form:",s)}})},formatNumber(t){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)},doExcel(){var s;let t=Object.create({});t.id=(s=this.invoiceItems.data[0])==null?void 0:s.invoice_id,axios.post("/exportBillingItemExcel",t,{responseType:"blob"}).then(n=>{var c,p,m,u;console.log(n);var g=document.createElement("a");document.body.appendChild(g),g.style="display: none";var y=new Blob([n.data],{type:n.headers["content-type"]});const d=document.createElement("a");d.href=window.URL.createObjectURL(y),d.download=`billings_${(c=this.invoiceItems.data[0].invoice.isp)==null?void 0:c.name}_${(u=(m=(p=this.invoiceItems.data[0])==null?void 0:p.invoice)==null?void 0:m.bill)==null?void 0:u.bill_number}_${new Date().toISOString().split("T")[0]}.xlsx`,d.click()})}}}),V={class:"py-12"},O={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},R={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},z={key:0,class:"mb-6 grid grid-cols-3 gap-4"},G={class:"space-y-2"},Q={class:"text-lg space-y-1"},Y={class:"space-y-2 col-span-2"},q={class:"bg-gray-50 rounded p-2 text-sm"},H={class:"col-span-2 truncate"},J={class:"text-center"},K={class:"text-right font-medium"},W={class:"mt-8"},X={class:"flex justify-between items-center mb-4"},Z={class:"flex space-x-4"},ee={class:"w-48"},te={class:"w-64"},se={class:"overflow-x-auto"},oe={class:"min-w-full divide-y divide-gray-200"},ie={class:"bg-white divide-y divide-gray-200"},ne={class:"px-6 py-4 whitespace-nowrap"},ae={class:"px-6 py-4 whitespace-nowrap"},le={class:"px-6 py-4 whitespace-nowrap"},re={class:"px-6 py-4 whitespace-nowrap"},de={class:"px-6 py-4 whitespace-nowrap"},ce={class:"px-6 py-4 whitespace-nowrap"},pe={class:"px-6 py-4 whitespace-nowrap"},me=["onClick"],ue=["onClick"],fe={class:"mt-4"},ge={class:"mt-6 flex justify-end space-x-3"};function he(t,s,n,g,y,d){const c=f("Pagination"),p=f("Link"),m=f("EditInvoiceItem"),u=f("AppLayout");return a(),M(u,{title:"Invoice Details"},{header:h(()=>s[3]||(s[3]=[e("h2",{class:"font-semibold text-xl text-white leading-tight"}," Invoice Details ",-1)])),default:h(()=>{var x,b,w,_,I;return[e("div",V,[e("div",O,[e("div",R,[t.invoiceItems.data.length>0?(a(),l("div",z,[e("div",G,[s[7]||(s[7]=e("h3",{class:"text-lg font-semibold"},"Invoice Info",-1)),e("div",Q,[e("p",null,[s[4]||(s[4]=e("span",{class:"font-medium"},"ISP:",-1)),r(" "+i((x=t.invoiceItems.data[0].invoice.isp)==null?void 0:x.name),1)]),e("p",null,[s[5]||(s[5]=e("span",{class:"font-medium"},"Bill Period:",-1)),r(" "+i((w=(b=t.invoiceItems.data[0].invoice)==null?void 0:b.temp_bill)==null?void 0:w.billing_period),1)]),e("p",null,[s[6]||(s[6]=e("span",{class:"font-medium"},"Status:",-1)),r(" "+i((I=(_=t.invoiceItems.data[0].invoice)==null?void 0:_.temp_bill)==null?void 0:I.status),1)])])]),e("div",Y,[s[9]||(s[9]=e("h3",{class:"text-lg font-semibold"},"Summary Brakedown",-1)),e("div",q,[s[8]||(s[8]=e("div",{class:"grid grid-cols-5 gap-2 border-b border-gray-200 pb-1 mb-1"},[e("div",{class:"col-span-2 font-medium text-gray-600"},"Description"),e("div",{class:"text-center font-medium text-gray-600"},"QTY"),e("div",{class:"text-right font-medium text-gray-600"},"Total")],-1)),(a(!0),l(k,null,E(t.invoices,o=>(a(),l("div",{key:o.category,class:"grid grid-cols-5 gap-2 py-1 hover:bg-gray-100"},[e("div",H,i(o.category),1),e("div",J,i(o.total_customers),1),e("div",K,i(t.formatNumber(o.total_amount)),1)]))),128))])])])):N("",!0),e("div",W,[e("div",X,[s[12]||(s[12]=e("h3",{class:"text-lg font-semibold"},"Invoice Items",-1)),e("div",Z,[e("div",ee,[D(e("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.filters.type=o),class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},s[10]||(s[10]=[e("option",{value:""},"All Types",-1),e("option",{value:"FullPortLeasing"},"Full Portleasing",-1),e("option",{value:"ProRatedPortLeasing"},"Pro-rated Portleasing",-1),e("option",{value:"NewInstallation"},"New Installation",-1),e("option",{value:"Materials"},"Materials",-1),e("option",{value:"Maintenance"},"Maintenance",-1),e("option",{value:"Suspension"},"Suspension",-1)]),512),[[T,t.filters.type]])]),e("div",te,[D(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>t.filters.search=o),type:"text",placeholder:"Search customer name...",class:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[$,t.filters.search]])]),e("div",null,[e("a",{onClick:s[2]||(s[2]=(...o)=>t.doExcel&&t.doExcel(...o)),class:"cursor-pointer inline-flex items-center px-2 py-2 bg-green-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-green-700 active:bg-green-900 focus:outline-none focus:border-green-900 focus:ring focus:ring-green-300 disabled:opacity-25 transition"},s[11]||(s[11]=[r("Export "),e("i",{class:"ml-1 fa fa-download text-white"},null,-1)]))])])]),e("div",se,[e("table",oe,[s[13]||(s[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Customer"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Type"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Period"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Unit Price"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Total"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),e("tbody",ie,[(a(!0),l(k,null,E(t.filteredItems,o=>(a(),l("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",ne,i(o.customer.ftth_id),1),e("td",ae,i(o.customer.name),1),e("td",le,i(o.type),1),e("td",re,i(t.formatDate(o.start_date))+" - "+i(t.formatDate(o.end_date)),1),e("td",de,"$"+i(o.unit_price),1),e("td",ce,"$"+i(o.total_amount),1),e("td",pe,[e("button",{onClick:C=>t.openEditModal(o),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Edit ",8,me),e("button",{onClick:C=>t.deleteItem(o),class:"text-red-600 hover:text-red-900"}," Delete ",8,ue)])]))),128))])])]),e("div",fe,[v(c,{links:t.invoiceItems.links},null,8,["links"])])]),e("div",ge,[v(p,{href:t.route("showbill.show",{bill_id:t.invoiceItems.data[0].invoice.bill_id}),class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"},{default:h(()=>s[14]||(s[14]=[r(" Back to List ")])),_:1},8,["href"])])])])]),v(m,{show:t.showEditModal,invoiceItem:t.selectedItem,onClose:t.closeEditModal},null,8,["show","invoiceItem","onClose"])]}),_:1})}const Ie=F(U,[["render",he]]);export{Ie as default};
