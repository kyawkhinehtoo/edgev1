import{U as j}from"./Upload-BUhgHUTo.js";import{r as g,y as D,z as B,o as n,d as o,f as _,a as e,e as c,F as C,g as N,b as $,N as z,t as x,x as M,n as L,i as k}from"./app-D-9qcd9s.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={name:"File",components:{Upload:j},props:["data","permission"],setup(a){let t=g(!1),r=g(),s=g(!1),b=g("");function m(){s.value=!0,b.value={customer_id:a.data}}function f(){s.value=!1,h()}function d(u){console.log(a.permission),a.permission&&Toast.fire({title:"Are you sure?",text:"Once deleted, you will not be able to recover this data !",icon:"warning",timer:!1,position:"center",showCancelButton:!0,dangerMode:!0}).then(p=>{p.isConfirmed?y(u):Toast.fire("Your data is safe!")})}function y(u){u._method="DELETE",z.post("/deleteFile/"+u.id,u,{onSuccess(p){Toast.fire({icon:"success",title:"Your File has been Deleted !"}),h()}})}const v=async()=>{let u="/getCustomerFile/"+a.data;console.log(u);try{return await(await fetch(u)).json()}catch(p){console.error(p)}},F=u=>{u&&(s.value=!1,h(),Toast.fire({icon:"success",title:"Successfully Uploaded the File"}))},h=()=>{v().then(u=>{r.value=u})};return D(()=>{h()}),{file_list:r,add:s,deleteFile:d,addFile:m,closeFile:f,checkUpload:F,incident_id:b,loading:t}}},E={key:0,class:"flex w-full justify-end"},R={key:1,"wire:loading":"",class:"w-full flex flex-col items-center justify-center"},G={key:2},O={class:"overflow-x-auto rounded shadow"},W={class:"min-w-full divide-y divide-gray-200 table-auto"},Y={class:"bg-gray-50"},J={key:0,class:"px-4 py-2 text-xs font-semibold text-gray-600 uppercase text-right"},q={class:"bg-white divide-y divide-gray-100"},H={class:"px-4 py-2 whitespace-nowrap"},K={class:"px-4 py-2 whitespace-nowrap flex items-center gap-2"},Q=["href"],X={class:"px-4 py-2 whitespace-nowrap uppercase"},Z={class:"px-4 py-2 whitespace-nowrap"},ee={key:0,class:"px-4 py-2 whitespace-nowrap text-right"},te=["onClick"],le={key:0},se={key:3};function ie(a,t,r,s,b,m){const f=B("upload");return n(),o(C,null,[r.permission?(n(),o("div",E,[s.add?c("",!0):(n(),o("a",{key:0,href:"#",onClick:t[0]||(t[0]=d=>s.addFile()),class:"-mt-2 mb-2 text-center items-center px-4 py-3 bg-indigo-500 border border-transparent rounded-sm font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-400 active:bg-indigo-600 focus:outline-none focus:border-gray-900 disabled:opacity-25 transition mr-1"},t[2]||(t[2]=[_("Add File"),e("i",{class:"fas fa-plus-circle opacity-75 lg:ml-1 text-sm"},null,-1)]))),s.add?(n(),o("a",{key:1,href:"#",onClick:t[1]||(t[1]=d=>s.closeFile()),class:"-mt-2 mb-2 text-center items-center px-4 py-3 bg-indigo-500 border border-transparent rounded-sm font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-400 active:bg-indigo-600 focus:outline-none focus:border-gray-900 disabled:opacity-25 transition mr-1"},t[3]||(t[3]=[_("Close"),e("i",{class:"fas fa-times-circle opacity-75 lg:ml-1 text-sm"},null,-1)]))):c("",!0)])):c("",!0),s.file_list?c("",!0):(n(),o("div",R,t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"},null,-1),e("h2",{class:"text-center text-gray-600 text-sm font-semibold mt-2"},"Loading...",-1)]))),s.file_list&&!s.add?(n(),o("div",G,[e("div",O,[e("table",W,[e("thead",Y,[e("tr",null,[t[5]||(t[5]=e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"#",-1)),t[6]||(t[6]=e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"File",-1)),t[7]||(t[7]=e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"Type",-1)),t[8]||(t[8]=e("th",{class:"px-4 py-2 text-xs font-semibold text-left text-gray-600 uppercase"},"Created By",-1)),r.permission?(n(),o("th",J,"Action")):c("",!0)])]),e("tbody",q,[(n(!0),o(C,null,N(s.file_list,(d,y)=>{var v;return n(),o("tr",{key:d.id,class:"hover:bg-gray-50 transition"},[e("td",H,x(y+1),1),e("td",K,[e("a",{href:d.path,target:"_blank",class:"text-indigo-600 hover:underline"},[t[9]||(t[9]=e("i",{class:"fas fa-paperclip mr-1"},null,-1)),_(" "+x(d.name),1)],8,Q)]),e("td",X,x(d.file_extension),1),e("td",Z,x((v=d.user)==null?void 0:v.name),1),r.permission?(n(),o("td",ee,[e("button",{onClick:F=>s.deleteFile(d),class:"text-red-600 hover:text-red-800 transition",title:"Delete"},t[10]||(t[10]=[e("i",{class:"fa fa-trash"},null,-1)]),8,te)])):c("",!0)])}),128)),s.file_list.length===0?(n(),o("tr",le,t[11]||(t[11]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-400"},"No files found.",-1)]))):c("",!0)])])])])):c("",!0),s.add?(n(),o("div",se,[$(f,{data:s.incident_id,onStatus:s.checkUpload},null,8,["data","onStatus"])])):c("",!0)],64)}const we=P(A,[["render",ie]]),ae=["for"],ne={class:"relative"},oe=["disabled"],re={key:0,class:"space-y-1 text-center"},de={class:"text-sm text-gray-600"},ue={class:"font-medium text-indigo-600 hover:text-indigo-500"},ce={key:1,class:"relative w-full h-full"},fe=["src","alt"],ge={class:"absolute top-1 right-1 flex space-x-1 z-20"},me=["disabled","id"],pe={key:1,class:"mt-2 text-sm text-red-500"},xe={class:"relative"},be=["src","alt"],ke={__name:"ImageUploader",props:{modelValue:{type:[File,null],default:null},imageUrl:{type:String,default:null},submitStatus:{type:String,default:null},existingImage:{type:String,default:null},label:{type:String,default:""},uploadText:{type:String,default:"Click to upload"},disabled:{type:Boolean,default:!1},error:{type:String,default:""},id:{type:String,default:()=>`file-upload-${Math.random().toString(36).substring(2,9)}`}},emits:["update:modelValue","update:imageUrl"],setup(a,{emit:t}){const r=a,s=t,b=g(null),m=g(!1),f=g(r.imageUrl||r.existingImage),d=g(!1),y=g(null);M(()=>r.existingImage,i=>{if(i){const l=i.replace(/\/customer\/\d+\//,"/");f.value=l,s("update:imageUrl",l)}}),D(()=>{if(r.existingImage){const i=r.existingImage.replace(/\/customer\/\d+\//,"/");f.value=i,s("update:imageUrl",i)}});function v(i){b.value=i}function F(){r.disabled||b.value.click()}function h(i){m.value=!0}function u(i){m.value=!1}function p(i){if(m.value=!1,r.disabled)return;const l=i.dataTransfer.files;if(l.length>0){const w=l[0];w.type.startsWith("image/")&&I(w)}}function U(i){const l=i.target.files[0];l&&I(l)}function I(i){if(i.size>10*1024*1024){alert("File size exceeds 10MB limit");return}s("update:modelValue",i);const l=new FileReader;l.onload=w=>{f.value=w.target.result,s("update:imageUrl",w.target.result)},l.readAsDataURL(i)}function V(i){i.stopPropagation(),s("update:modelValue",null),f.value=null,s("update:imageUrl",null)}function T(i){y.value=i,d.value=!0}function S(){d.value=!1,y.value=null}return(i,l)=>(n(),o(C,null,[e("div",null,[a.label?(n(),o("label",{key:0,for:a.id,class:"block text-sm font-medium text-gray-700 mb-1"},x(a.label),9,ae)):c("",!0),e("div",ne,[e("div",{class:L(["flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-md border-gray-300 hover:border-indigo-500 transition-colors duration-200 cursor-pointer bg-gray-50",{"border-indigo-500 bg-indigo-50":m.value}]),onClick:F,onDragover:k(h,["prevent"]),onDragleave:k(u,["prevent"]),onDrop:k(p,["prevent"]),disabled:a.disabled},[f.value?(n(),o("div",ce,[e("img",{src:f.value,alt:`${a.label} Preview`,class:"object-contain w-full h-full rounded-md"},null,8,fe),e("div",ge,[e("button",{onClick:l[0]||(l[0]=k(w=>T(a.id),["stop"])),type:"button",class:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-blue-600 transition-colors duration-200",title:"Open Full View"},l[4]||(l[4]=[e("i",{class:"fas fa-external-link-alt text-xs"},null,-1)])),a.submitStatus!=="approved"?(n(),o("button",{key:0,onClick:k(V,["stop"]),type:"button",class:"bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition-colors duration-200",title:"Remove image"},l[5]||(l[5]=[e("i",{class:"fas fa-times text-xs"},null,-1)]))):c("",!0)])])):(n(),o("div",re,[l[2]||(l[2]=e("i",{class:"fas fa-cloud-upload-alt text-3xl text-gray-400"},null,-1)),e("div",de,[e("span",ue,x(a.uploadText),1),l[1]||(l[1]=e("span",null," or drag and drop",-1))]),l[3]||(l[3]=e("p",{class:"text-xs text-gray-500"}," PNG, JPG, GIF up to 10MB ",-1))]))],42,oe),a.submitStatus!=="approved"?(n(),o("input",{key:0,ref:v,type:"file",onChange:U,accept:"image/*",class:"hidden",disabled:a.disabled,id:a.id},null,40,me)):c("",!0)]),a.error?(n(),o("p",pe,x(a.error),1)):c("",!0)]),d.value?(n(),o("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:S},[e("div",xe,[e("img",{class:"max-h-[90vh] max-w-[90vw]",src:f.value,alt:a.label||"Image preview"},null,8,be),e("button",{class:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-8 h-8 flex items-center justify-center",onClick:S},l[6]||(l[6]=[e("span",{class:"text-xl"},"Ã—",-1)]))])])):c("",!0)],64))}};export{we as C,ke as _};
